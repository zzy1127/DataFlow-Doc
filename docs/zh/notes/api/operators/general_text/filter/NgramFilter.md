---
title: NgramFilter
createTime: 2025/10/09 17:09:04
permalink: /zh/api/operators/general_text/filter/ngramfilter/
---

## ğŸ“˜ æ¦‚è¿°

`NgramFilter` æ˜¯ä¸€ä¸ªåŸºäºN-gramåˆ†æ•°çš„æ–‡æœ¬è¿‡æ»¤ç®—å­ã€‚å®ƒé€šè¿‡è®¡ç®—æ–‡æœ¬ä¸­n-gramçš„é‡å¤æ¯”ä¾‹æ¥è¯„ä¼°æ–‡æœ¬çš„å†—ä½™åº¦ï¼Œå¹¶æ ¹æ®è®¾å®šçš„åˆ†æ•°é˜ˆå€¼è¿‡æ»¤æ‰å†—ä½™åº¦è¾ƒé«˜æˆ–è¿‡ä½çš„æ–‡æœ¬ã€‚å¾—åˆ†è¶Šé«˜è¡¨ç¤ºé‡å¤æ¯”ä¾‹è¶Šä½ï¼Œæ–‡æœ¬è´¨é‡é€šå¸¸è¶Šé«˜ã€‚

## `__init__`å‡½æ•°

```python
__init__(self, min_score=0.8, max_score=1, ngrams=5)
```

### initå‚æ•°è¯´æ˜

| å‚æ•°å          | ç±»å‹  | é»˜è®¤å€¼ | è¯´æ˜                                     |
| :-------------- | :---- | :----- | :--------------------------------------- |
| **min_score**   | float | 0.8    | æœ€å°n-gramå¾—åˆ†é˜ˆå€¼ï¼Œä½äºæ­¤å€¼çš„æ–‡æœ¬å°†è¢«è¿‡æ»¤ã€‚ |
| **max_score**   | int   | 1      | æœ€å¤§n-gramå¾—åˆ†é˜ˆå€¼ï¼Œé«˜äºæ­¤å€¼çš„æ–‡æœ¬å°†è¢«è¿‡æ»¤ã€‚ |
| **ngrams**      | int   | 5      | ç”¨äºè®¡ç®—é‡å¤ç‡çš„n-gramå¤§å°ã€‚             |

## `run`å‡½æ•°

```python
run(self, storage: DataFlowStorage, input_key: str, output_key: str='NgramScore')
```

#### å‚æ•°

| åç§°          | ç±»å‹            | é»˜è®¤å€¼         | è¯´æ˜                                       |
| :------------ | :-------------- | :------------- | :----------------------------------------- |
| **storage**   | DataFlowStorage | å¿…éœ€           | æ•°æ®æµå­˜å‚¨å®ä¾‹ï¼Œè´Ÿè´£è¯»å–ä¸å†™å…¥æ•°æ®ã€‚       |
| **input_key** | str             | å¿…éœ€           | è¾“å…¥åˆ—åï¼Œå¯¹åº”å¾…è¯„ä¼°å†—ä½™åº¦çš„æ–‡æœ¬å­—æ®µã€‚     |
| **output_key**| str             | "NgramScore"   | è¾“å‡ºåˆ—åï¼Œå¯¹åº”ç”Ÿæˆçš„n-gramåˆ†æ•°å­—æ®µã€‚       |

## ğŸ§  ç¤ºä¾‹ç”¨æ³•

```python
from dataflow.operators.general_text import NgramFilter
from dataflow.utils.storage import FileStorage

class NgramFilterTest():
    def __init__(self):
        self.storage = FileStorage(
            first_entry_file_name="./dataflow/example/GeneralTextPipeline/ngram_test_input.jsonl",
            cache_path="./cache",
            file_name_prefix="dataflow_cache_step",
            cache_type="jsonl",
        )
        
        self.filter = NgramFilter(
            min_score=0.8,
            max_score=1.0,
            ngrams=5
        )
        
    def forward(self):
        self.filter.run(
            storage=self.storage.step(),
            input_key='text',
            output_key='NgramScore'
        )

if __name__ == "__main__":
    test = NgramFilterTest()
    test.forward()
```

#### ğŸ§¾ é»˜è®¤è¾“å‡ºæ ¼å¼ï¼ˆOutput Formatï¼‰

ç®—å­ä¼šå‘æ•°æ®ä¸­æ·»åŠ ä¸€ä¸ª`output_key`ï¼ˆé»˜è®¤ä¸º`NgramScore`ï¼‰å­—æ®µï¼Œå¹¶ä»…ä¿ç•™åˆ†æ•°åœ¨`[min_score, max_score]`èŒƒå›´å†…çš„æ•°æ®è¡Œã€‚

| å­—æ®µ         | ç±»å‹  | è¯´æ˜                         |
| :----------- | :---- | :--------------------------- |
| NgramScore   | float | æ¨¡å‹ç”Ÿæˆçš„N-gramåˆ†æ•°ã€‚       |

### ğŸ“‹ ç¤ºä¾‹è¾“å…¥

```json
{"text": "ä»Šå¤©å¤©æ°”çœŸä¸é”™ï¼Œé˜³å…‰æ˜åªšï¼Œä¸‡é‡Œæ— äº‘ï¼Œé€‚åˆå‡ºé—¨æ•£æ­¥ã€‚"}
{"text": "å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½"}
{"text": "The fascinating world of natural language processing encompasses various sophisticated algorithms."}
```

### ğŸ“¤ ç¤ºä¾‹è¾“å‡º

```json
{"text": "The fascinating world of natural language processing encompasses various sophisticated algorithms.", "NgramScore": 1.0}
```

### ğŸ“Š ç»“æœåˆ†æ

**æ ·æœ¬1ï¼ˆ"ä»Šå¤©å¤©æ°”çœŸä¸é”™ï¼Œé˜³å…‰æ˜åªšï¼Œä¸‡é‡Œæ— äº‘ï¼Œé€‚åˆå‡ºé—¨æ•£æ­¥ã€‚"ï¼‰**ï¼š
- æ–‡æœ¬é•¿åº¦ï¼š26 å­—ç¬¦
- 5-gram æ€»æ•°ï¼š22 ä¸ª
- å”¯ä¸€ 5-gram æ•°é‡ï¼šçº¦ 20 ä¸ª
- N-gram åˆ†æ•°ï¼š20 / 22 â‰ˆ 0.91
- åˆ†æ•°èŒƒå›´ï¼š[0.8, 1.0]
- **é€šè¿‡è¿‡æ»¤**ï¼ˆä½†è¾“å‡ºä¸­æœªæ˜¾ç¤ºï¼Œå¯èƒ½å› ä¸ºåªæ˜¾ç¤ºäº†é€šè¿‡çš„æ ·æœ¬ï¼‰

**æ ·æœ¬2ï¼ˆ"å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½"ï¼‰**ï¼š
- æ–‡æœ¬é•¿åº¦ï¼š26 å­—ç¬¦
- 5-gram æ€»æ•°ï¼š22 ä¸ª
- å”¯ä¸€ 5-gram æ•°é‡ï¼šçº¦ 1-2 ä¸ªï¼ˆé‡å¤çš„"å¥½å¥½å¥½å¥½å¥½"ï¼‰
- N-gram åˆ†æ•°ï¼š1 / 22 â‰ˆ 0.045
- åˆ†æ•°èŒƒå›´ï¼š[0.8, 1.0]
- **æœªé€šè¿‡è¿‡æ»¤**ï¼ˆ0.045 < 0.8ï¼Œé‡å¤ç‡è¿‡é«˜ï¼‰

**æ ·æœ¬3ï¼ˆ"The fascinating world of natural language processing..."ï¼‰**ï¼š
- æ–‡æœ¬é•¿åº¦ï¼š95 å­—ç¬¦
- 5-gram æ€»æ•°ï¼š91 ä¸ª
- å”¯ä¸€ 5-gram æ•°é‡ï¼š91 ä¸ªï¼ˆæ— é‡å¤ï¼‰
- N-gram åˆ†æ•°ï¼š91 / 91 = 1.0
- åˆ†æ•°èŒƒå›´ï¼š[0.8, 1.0]
- **é€šè¿‡è¿‡æ»¤**ï¼ˆ1.0 åœ¨èŒƒå›´å†…ï¼Œæ–‡æœ¬æ— å†—ä½™ï¼‰

**è®¡ç®—å…¬å¼**ï¼š
```
N-gram Score = å”¯ä¸€ n-gram æ•°é‡ / æ€» n-gram æ•°é‡
```

**å¾—åˆ†å«ä¹‰**ï¼š
- **1.0**ï¼šæ–‡æœ¬å®Œå…¨æ— é‡å¤ï¼Œè´¨é‡æœ€é«˜
- **0.8-0.99**ï¼šæ–‡æœ¬æœ‰å°‘é‡é‡å¤ï¼Œè´¨é‡è¾ƒå¥½
- **< 0.8**ï¼šæ–‡æœ¬é‡å¤ç‡é«˜ï¼Œè´¨é‡è¾ƒå·®

**åº”ç”¨åœºæ™¯**ï¼š
- è¿‡æ»¤ä½è´¨é‡ã€é«˜é‡å¤çš„æ–‡æœ¬
- æ£€æµ‹ç”Ÿæˆæ–‡æœ¬ä¸­çš„å¾ªç¯é‡å¤
- æ•°æ®é›†è´¨é‡æ§åˆ¶
- è¿‡æ»¤çˆ¬è™«æ•°æ®ä¸­çš„æ¨¡æ¿æ–‡æœ¬

**æ³¨æ„äº‹é¡¹**ï¼š
- ä½¿ç”¨å­—ç¬¦çº§ n-gramï¼ˆé»˜è®¤ n=5ï¼‰ï¼Œé€‚åˆä¸­è‹±æ–‡æ··åˆ
- å¾—åˆ†è¶Šé«˜è¡¨ç¤ºæ–‡æœ¬å¤šæ ·æ€§è¶Šå¥½
- çŸ­æ–‡æœ¬ï¼ˆ< n ä¸ªå­—ç¬¦ï¼‰å¯èƒ½å¾—åˆ†å¼‚å¸¸
- ä¸åŒè¯­è¨€å’Œåœºæ™¯å¯èƒ½éœ€è¦è°ƒæ•´ `min_score` é˜ˆå€¼
- è¯—æ­Œã€æ­Œè¯ç­‰ç‰¹æ®Šæ–‡æœ¬ç±»å‹å¯èƒ½å› é‡å¤è€Œå¾—åˆ†ä½
