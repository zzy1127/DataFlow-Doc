---
title: NgramFilter
createTime: 2025/10/09 17:09:04
permalink: /zh/api/operators/general_text/filter/ngramfilter/
---

## ğŸ“˜ æ¦‚è¿°

`NgramFilter` æ˜¯ä¸€ä¸ªåŸºäºN-gramåˆ†æ•°çš„æ–‡æœ¬è¿‡æ»¤ç®—å­ã€‚å®ƒé€šè¿‡è®¡ç®—æ–‡æœ¬ä¸­n-gramçš„é‡å¤æ¯”ä¾‹æ¥è¯„ä¼°æ–‡æœ¬çš„å†—ä½™åº¦ï¼Œå¹¶æ ¹æ®è®¾å®šçš„åˆ†æ•°é˜ˆå€¼è¿‡æ»¤æ‰å†—ä½™åº¦è¾ƒé«˜æˆ–è¿‡ä½çš„æ–‡æœ¬ã€‚å¾—åˆ†è¶Šé«˜è¡¨ç¤ºé‡å¤æ¯”ä¾‹è¶Šä½ï¼Œæ–‡æœ¬è´¨é‡é€šå¸¸è¶Šé«˜ã€‚æ”¯æŒ **ä¸­æ–‡ï¼ˆæŒ‰å­—åˆ‡åˆ†ï¼‰** ä¸ **è‹±æ–‡ï¼ˆæŒ‰è¯åˆ‡åˆ†ï¼‰** ä¸¤ç§æ¨¡å¼ã€‚

## `__init__`å‡½æ•°

```python
__init__(self, min_score=0.8, max_score=1, ngrams=5, language: str = 'en')
```

### initå‚æ•°è¯´æ˜

| å‚æ•°å          | ç±»å‹  | é»˜è®¤å€¼ | è¯´æ˜                                       |
| :-------------- | :---- | :----- | :----------------------------------------- |
| **min_score**   | float | 0.8    | æœ€å°n-gramå¾—åˆ†é˜ˆå€¼ï¼Œä½äºæ­¤å€¼çš„æ–‡æœ¬å°†è¢«è¿‡æ»¤ã€‚ |
| **max_score**   | int   | 1      | æœ€å¤§n-gramå¾—åˆ†é˜ˆå€¼ï¼Œé«˜äºæ­¤å€¼çš„æ–‡æœ¬å°†è¢«è¿‡æ»¤ã€‚ |
| **ngrams**      | int   | 5      | ç”¨äºè®¡ç®—é‡å¤ç‡çš„n-gramå¤§å°ã€‚               |
| **language**    | str   | 'en'   | å¤„ç†è¯­è¨€ï¼›`'zh'` ä¸ºä¸­æ–‡æŒ‰â€œå­—â€åˆ‡åˆ†ï¼Œå…¶å®ƒå€¼æŒ‰â€œè¯â€åˆ‡åˆ†ã€‚ |

## `run`å‡½æ•°

```python
run(self, storage: DataFlowStorage, input_key: str, output_key: str='NgramScore')
```

#### å‚æ•°

| åç§°          | ç±»å‹            | é»˜è®¤å€¼         | è¯´æ˜                                       |
| :------------ | :-------------- | :------------- | :----------------------------------------- |
| **storage**   | DataFlowStorage | å¿…éœ€           | æ•°æ®æµå­˜å‚¨å®ä¾‹ï¼Œè´Ÿè´£è¯»å–ä¸å†™å…¥æ•°æ®ã€‚       |
| **input_key** | str             | å¿…éœ€           | è¾“å…¥åˆ—åï¼Œå¯¹åº”å¾…è¯„ä¼°å†—ä½™åº¦çš„æ–‡æœ¬å­—æ®µã€‚     |
| **output_key**| str             | "NgramScore"   | è¾“å‡ºåˆ—åï¼Œå¯¹åº”ç”Ÿæˆçš„n-gramåˆ†æ•°å­—æ®µã€‚       |

## ğŸ§  ç¤ºä¾‹ç”¨æ³•

```python
from dataflow.operators.general_text import NgramFilter
from dataflow.utils.storage import FileStorage

class NgramFilterTest():
    def __init__(self):
        self.storage = FileStorage(
            first_entry_file_name="./dataflow/example/GeneralTextPipeline/ngram_test_input.jsonl",
            cache_path="./cache",
            file_name_prefix="dataflow_cache_step",
            cache_type="jsonl",
        )

        # ä¾‹å¦‚ï¼šä¸­æ–‡è¿‡æ»¤
        self.filter = NgramFilter(
            min_score=0.8,
            max_score=1.0,
            ngrams=5,
            language='zh'
        )
        
    def forward(self):
        self.filter.run(
            storage=self.storage.step(),
            input_key='text',
            output_key='NgramScore'
        )

if __name__ == "__main__":
    test = NgramFilterTest()
    test.forward()
```

#### ğŸ§¾ é»˜è®¤è¾“å‡ºæ ¼å¼ï¼ˆOutput Formatï¼‰

ç®—å­ä¼šå‘æ•°æ®ä¸­æ·»åŠ ä¸€ä¸ª`output_key`ï¼ˆé»˜è®¤ä¸º`NgramScore`ï¼‰å­—æ®µï¼Œå¹¶ä»…ä¿ç•™åˆ†æ•°åœ¨`[min_score, max_score]`èŒƒå›´å†…çš„æ•°æ®è¡Œã€‚

| å­—æ®µ         | ç±»å‹  | è¯´æ˜                         |
| :----------- | :---- | :--------------------------- |
| NgramScore   | float | æ¨¡å‹ç”Ÿæˆçš„N-gramåˆ†æ•°ã€‚       |

### ğŸ“‹ ç¤ºä¾‹è¾“å…¥

```json
{"id":1,"type":"zh_normal","text":"äººå·¥æ™ºèƒ½åœ¨å¤§æ¨¡å‹é¢†åŸŸçš„åº”ç”¨å·²ç»éå¸¸å¹¿æ³›ï¼Œä»æ–‡æœ¬ç”Ÿæˆåˆ°é€»è¾‘æ¨ç†éƒ½æœ‰æ˜¾è‘—è¿›æ­¥ï¼Œæœªæ¥å¯æœŸã€‚"}
{"id":2,"type":"zh_repeat_phrase","text":"é‡è¦çš„äº‹æƒ…è¯´ä¸‰éï¼šä¸è¦è¿‡æ‹Ÿåˆï¼ä¸è¦è¿‡æ‹Ÿåˆï¼ä¸è¦è¿‡æ‹Ÿåˆï¼è¿™å°±å«é‡è¦çš„äº‹æƒ…è¯´ä¸‰éã€‚"}
{"id":3,"type":"zh_garbage","text":"å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ"}

{"id":1,"type":"en_normal","text":"Natural language processing is a subfield of linguistics, computer science, and artificial intelligence."}
{"id":2,"type":"en_repeat_phrase","text":"The cat sat on the mat. The cat sat on the mat. The cat sat on the mat. The cat sat on the mat."}
{"id":3,"type":"en_garbage","text":"test test test test test test test test test test test test test test test test test test"}
```

### ğŸ“¤ ç¤ºä¾‹è¾“å‡º

```json
// å‡è®¾æˆ‘ä»¬å¯¹ä¸­æ–‡ä¸è‹±æ–‡åˆ†åˆ«è·‘ä¸€éè¿‡æ»¤æµç¨‹

// ä¸­æ–‡æ¨¡å¼ï¼ˆlanguage='zh'ï¼‰ï¼Œé˜ˆå€¼ [0.8, 1.0]
{"id":1,"type":"zh_normal","text":"äººå·¥æ™ºèƒ½åœ¨å¤§æ¨¡å‹é¢†åŸŸçš„åº”ç”¨å·²ç»éå¸¸å¹¿æ³›ï¼Œä»æ–‡æœ¬ç”Ÿæˆåˆ°é€»è¾‘æ¨ç†éƒ½æœ‰æ˜¾è‘—è¿›æ­¥ï¼Œæœªæ¥å¯æœŸã€‚","NgramScore":1.0}

// è‹±æ–‡æ¨¡å¼ï¼ˆlanguage='en'ï¼‰ï¼Œé˜ˆå€¼ [0.8, 1.0]
{"id":1,"type":"en_normal","text":"Natural language processing is a subfield of linguistics, computer science, and artificial intelligence.","NgramScore":1.0}
```

### ğŸ“Š ç»“æœåˆ†æ

**ä¸­æ–‡æ ·æœ¬ï¼ˆlanguage='zh'ï¼‰**ï¼š

- **æ ·æœ¬ zh_normal**  
  - N-gram åˆ†æ•°ï¼š`NgramScore = 1.0`  
  - å«ä¹‰ï¼šæ–‡æœ¬å†…å®¹ä¸°å¯Œã€é‡å¤æå°‘ï¼Œå†—ä½™åº¦æœ€ä½ã€‚  
  - é˜ˆå€¼èŒƒå›´ï¼š[0.8, 1.0]  
  - **é€šè¿‡è¿‡æ»¤**ï¼ˆ1.0 åœ¨é˜ˆå€¼åŒºé—´å†…ï¼‰

- **æ ·æœ¬ zh_repeat_phrase**  
  - N-gram åˆ†æ•°ï¼š`NgramScore â‰ˆ 0.6667`  
  - å«ä¹‰ï¼šå­˜åœ¨é‡å¤çš„â€œä¸‰éå£å·â€ï¼Œn-gram æœ‰æ˜æ˜¾é‡å¤ã€‚  
  - é˜ˆå€¼èŒƒå›´ï¼š[0.8, 1.0]  
  - **æœªé€šè¿‡è¿‡æ»¤**ï¼ˆ0.6667 < 0.8ï¼‰

- **æ ·æœ¬ zh_garbage**  
  - N-gram åˆ†æ•°ï¼š`NgramScore = 0.03125`  
  - å«ä¹‰ï¼šå‡ ä¹å…¨ç”±â€œå“ˆâ€é‡å¤æ„æˆï¼Œå±äºé«˜åº¦åƒåœ¾/æ¨¡æ¿åŒ–æ–‡æœ¬ã€‚  
  - é˜ˆå€¼èŒƒå›´ï¼š[0.8, 1.0]  
  - **æœªé€šè¿‡è¿‡æ»¤**ï¼ˆä¸¥é‡é‡å¤ï¼‰

**è‹±æ–‡æ ·æœ¬ï¼ˆlanguage='en'ï¼‰**ï¼š

- **æ ·æœ¬ en_normal**  
  - N-gram åˆ†æ•°ï¼š`NgramScore = 1.0`  
  - å«ä¹‰ï¼šå¥å­ä¿¡æ¯å¯†åº¦é«˜ï¼Œ5-gram ç»„åˆå‡ ä¹å…¨éƒ¨å”¯ä¸€ã€‚  
  - é˜ˆå€¼èŒƒå›´ï¼š[0.8, 1.0]  
  - **é€šè¿‡è¿‡æ»¤**

- **æ ·æœ¬ en_repeat_phrase**  
  - N-gram åˆ†æ•°ï¼š`NgramScore = 0.3`  
  - å«ä¹‰ï¼šé‡å¤å¤šæ¬¡ â€œThe cat sat on the mat.â€ï¼Œå¤§é‡ n-gram é‡å¤ã€‚  
  - é˜ˆå€¼èŒƒå›´ï¼š[0.8, 1.0]  
  - **æœªé€šè¿‡è¿‡æ»¤**

- **æ ·æœ¬ en_garbage**  
  - N-gram åˆ†æ•°ï¼š`NgramScore â‰ˆ 0.0714`  
  - å«ä¹‰ï¼šå‡ ä¹å…¨éƒ¨ç”±é‡å¤çš„ `test` ç»„æˆï¼Œæ˜¯å…¸å‹åƒåœ¾æ–‡æœ¬ã€‚  
  - é˜ˆå€¼èŒƒå›´ï¼š[0.8, 1.0]  
  - **æœªé€šè¿‡è¿‡æ»¤**

> ç»¼ä¸Šï¼Œå½“æˆ‘ä»¬è®¾ç½®é˜ˆå€¼ `[min_score=0.8, max_score=1.0]` æ—¶ï¼Œ**åªä¼šä¿ç•™é«˜è´¨é‡ã€é‡å¤åº¦å¾ˆä½çš„æ–‡æœ¬ï¼ˆå¦‚ zh_normal / en_normalï¼‰**ï¼Œè€Œå„ç§é‡å¤å£å·å¼ã€çŒæ°´æˆ–åƒåœ¾æ–‡æœ¬ä¼šè¢«è¿‡æ»¤æ‰ã€‚

**è®¡ç®—å…¬å¼**ï¼š
```
N-gram Score = å”¯ä¸€ n-gram æ•°é‡ / æ€» n-gram æ•°é‡
```

**å¾—åˆ†å«ä¹‰**ï¼š
- **1.0**ï¼šæ–‡æœ¬å®Œå…¨æ— é‡å¤ï¼Œè´¨é‡æœ€é«˜
- **0.8-0.99**ï¼šæ–‡æœ¬æœ‰å°‘é‡é‡å¤ï¼Œè´¨é‡è¾ƒå¥½
- **< 0.8**ï¼šæ–‡æœ¬é‡å¤ç‡é«˜ï¼Œè´¨é‡è¾ƒå·®

**åº”ç”¨åœºæ™¯**ï¼š
- è¿‡æ»¤ä½è´¨é‡ã€é«˜é‡å¤çš„æ–‡æœ¬
- æ£€æµ‹ç”Ÿæˆæ–‡æœ¬ä¸­çš„å¾ªç¯é‡å¤
- æ•°æ®é›†è´¨é‡æ§åˆ¶
- è¿‡æ»¤çˆ¬è™«æ•°æ®ä¸­çš„æ¨¡æ¿æ–‡æœ¬

**æ³¨æ„äº‹é¡¹**ï¼š
- ä½¿ç”¨å­—ç¬¦çº§ n-gramï¼ˆé»˜è®¤ n=5ï¼‰ï¼Œé€‚åˆä¸­è‹±æ–‡æ··åˆ
- å¾—åˆ†è¶Šé«˜è¡¨ç¤ºæ–‡æœ¬å¤šæ ·æ€§è¶Šå¥½
- çŸ­æ–‡æœ¬ï¼ˆ< n ä¸ªå­—ç¬¦ï¼‰å¯èƒ½å¾—åˆ†å¼‚å¸¸
- ä¸åŒè¯­è¨€å’Œåœºæ™¯å¯èƒ½éœ€è¦è°ƒæ•´ `min_score` é˜ˆå€¼
- è¯—æ­Œã€æ­Œè¯ç­‰ç‰¹æ®Šæ–‡æœ¬ç±»å‹å¯èƒ½å› é‡å¤è€Œå¾—åˆ†ä½
