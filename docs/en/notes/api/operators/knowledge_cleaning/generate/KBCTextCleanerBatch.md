---
title: KBCTextCleanerBatch
createTime: 2025/10/09 16:52:48
permalink: /en/api/operators/knowledge_cleaning/generate/kbctextcleanerbatch/
---

## ğŸ“˜ Overview

`KBCTextCleanerBatch` is a **batch knowledge-cleaning operator** designed to standardize raw knowledge content by removing HTML tags, normalizing special characters, processing hyperlinks, and optimizing structure â€” all to enhance the quality of RAG (Retrieval-Augmented Generation) knowledge bases.

---

## **init** Function

```python
def __init__(self, llm_serving: LLMServingABC, lang="en", prompt_template=None)
```

### Initialization Parameters

| Parameter           | Type          | Default  | Description                                                                                                                         |
| :------------------ | :------------ | :------- | :---------------------------------------------------------------------------------------------------------------------------------- |
| **llm_serving**     | LLMServingABC | Required | The large language model service instance used for inference and text generation.                                                   |
| **lang**            | str           | "en"     | Specifies the language of the prompt. Supports `"zh"` (Chinese) and `"en"` (English).                                               |
| **prompt_template** | PromptABC     | None     | The prompt template object for constructing cleaning instructions. If not specified, the built-in `KnowledgeCleanerPrompt` is used. |

---

### Prompt Template Description

| Prompt Template            | Purpose                         | Application Scenario            | Key Features                                                     |
| -------------------------- | ------------------------------- | ------------------------------- | ---------------------------------------------------------------- |
| **KnowledgeCleanerPrompt** | Multi-dimensional text cleaning | Private knowledge base cleaning | Removes sensitive information and noise; performs normalization. |

---

## run Function

```python
def run(storage, input_key="chunk_path", output_key="cleaned_chunk_path")
```

Executes the main logic of the operator â€” it reads the input DataFrame from the storage, cleans the text files located at the given paths, and writes the cleaned results back to new files.

### Parameters

| Name           | Type            | Default              | Description                                                                               |
| :------------- | :-------------- | :------------------- | :---------------------------------------------------------------------------------------- |
| **storage**    | DataFlowStorage | Required             | The data flow storage instance responsible for reading and writing data.                  |
| **input_key**  | str             | "chunk_path"         | The input column name that contains the file paths of the knowledge chunks to be cleaned. |
| **output_key** | str             | "cleaned_chunk_path" | The output column name that stores the file paths of the cleaned knowledge chunks.        |

---

## ğŸ§  Example Usage

```python
self.knowledge_cleaning_step3 = KBCTextCleanerBatch(
    llm_serving=self.llm_serving,
    lang="en"
)
self.knowledge_cleaning_step3.run(
    storage=self.storage.step(),
)
```

---

## ğŸ§¾ Default Output Format

| Field                  | Type | Description                                                |
| :--------------------- | :--- | :--------------------------------------------------------- |
| **chunk_path**         | str  | Path to the original raw knowledge text.                   |
| **cleaned_chunk_path** | str  | Path to the cleaned knowledge text generated by the model. |

### Example Input (File pointed by `chunk_path`)

```json
{
"raw_chunk":"<div class=\"container\">\n  <h1>æ ‡é¢˜æ–‡æœ¬</h1>\n  <p>æ­£æ–‡æ®µè½ï¼ŒåŒ…æ‹¬ç‰¹æ®Šç¬¦å·ï¼Œä¾‹å¦‚â€œå¼¯å¼•å·â€ã€â€“ç ´æŠ˜å·ç­‰</p>\n  <img src=\"example.jpg\" alt=\"ç¤ºæ„å›¾\">\n  <a href=\"...\">é“¾æ¥æ–‡æœ¬</a>\n  <pre><code>ä»£ç ç‰‡æ®µ</code></pre>\n</div>"
}
```

### Example Output (File pointed by `cleaned_chunk_path`)

```json
{
"raw_chunk":"<div class=\"container\">\n  <h1>æ ‡é¢˜æ–‡æœ¬</h1>\n  <p>æ­£æ–‡æ®µè½ï¼ŒåŒ…æ‹¬ç‰¹æ®Šç¬¦å·ï¼Œä¾‹å¦‚â€œå¼¯å¼•å·â€ã€â€“ç ´æŠ˜å·ç­‰</p>\n  <img src=\"example.jpg\" alt=\"ç¤ºæ„å›¾\">\n  <a href=\"...\">é“¾æ¥æ–‡æœ¬</a>\n  <pre><code>ä»£ç ç‰‡æ®µ</code></pre>\n</div>",
"cleaned_chunk":"æ ‡é¢˜æ–‡æœ¬\n\næ­£æ–‡æ®µè½ï¼ŒåŒ…æ‹¬ç‰¹æ®Šç¬¦å·ï¼Œä¾‹å¦‚\"ç›´å¼•å·\"ã€-ç ´æŠ˜å·ç­‰\n\n[Image: ç¤ºæ„å›¾ example.jpg]\n\né“¾æ¥æ–‡æœ¬\n\n<code>ä»£ç ç‰‡æ®µ</code>"
}
```
